# sql基础

## 多表查询
1.题目如下：现在有两个表，“学生表”记录了学生的基本信息，有“学号”、“姓名”。“成绩”表记录了学生选修的课程，以及对应课程的成绩。这两个表通过“学号”进行关联。<br>
现在要查找出所有学生的学号，姓名，课程和成绩。
### 【解题思路】
1.确定查询结果
题目要求查询所有学生的姓名，学号，课程和成绩信息<br>
select 学号,姓名,课程,成绩<br>
查询结果的列名“学号”、“姓名”，在“学生”表里，列名“课程”、“成绩”在“成绩”表里，所以需要进行多表查询。<br>
2.哪种联结呢？<br>
涉及到多表查询，在之前的课程《从零学会sql：多表查询》里讲过需要用到联结。<br>
多表的联结又分为以下几种类型：<br>
1）左联结（left join），联结结果保留左表的全部数据<br>
2）右联结（right join），联结结果保留右表的全部数据<br>
3）内联结（inner join），取两表的公共数据<br>
这个题目里要求“所有学生”，而“所有学生”在“学生”表里。为什么不在“成绩”表里呢？<br>
如果有的学生没有选修课程，那么他就不会出现在“成绩”表里，所以“成绩”表没有包含“所有学生”。<br>
所以要以“学生”表进行左联结，保留左边表（学生表）里的全部数据。<br>
from 学生信息表 as a left join 成绩表 as b<br>
3.两个表联结条件是什么？<br>
两个表都有“学号”，所以联结条件为学号。<br>
on a.学号=b.学号<br>

### 【题解】
```mysql
   Selcet a.学号, a.姓名,b.课程,b.成绩
   from 学生表 as a left join 成绩表 as b 
   on a.学号 = b.学号
    
```

## 查找第二高的成绩
现在有“课程表”，记录了学生选修课程的名称以及成绩。现在需要找出语文课中成绩第二高的学生成绩。如果不存在第二高成绩的学生，那么查询应返回 null。<br>
### 【解题思路】
思路2：使用 limit 和 offet<br>
limit n子句表示查询结果返回前n条数据<br>
offset n表示跳过x条语句<br>
limit x offset y 分句表示查询结果跳过 y 条数据，读取前 x 条数据<br>
使用limit和offset，降序排列再返回第二条记录可以得到第二大的值。<br>
注意sql语句中不支持运算<br>
3. 考虑特殊情况<br>
题目要求，如果没有第二高的成绩，返回空值，所以这里用判断空值的函数（ifnull）函数来处理特殊情况。<br>
ifnull(a,b)函数解释：如果value1不是空，结果返回，如果value1是空，结果返回b<br>
### 【题解】
``` mysql
    select ifnull(
        (select distinct 成绩
         from 课程表 
         where 课程="语文"
         order by 成绩 desc 
         limit 1,1 
    ),null
    ) as 语文课成绩第二高
    

```
### 【本题考点】
1. 第二高的查询思路，利用本题的解决办法可以解决这类问题：查询第N高的数据
2. limit字句的用法
3. ifnull的用法
## 【举一反三】
 查找 Employee 表中第二高的薪水（Salary）。查询结果返回 200 作为第二高的薪水。如果不存在第二高的薪水，那么查询应返回 null。


 ### 【题解】
``` mysql 
      select ifNull(
          (select distinct salary 
           from Employee 
           order by Salary Desc
           limit 1,1),null
           ) as SecondHighestSalary;

```

## 排序类问题
### 【题目】
    编写 SQL 查询对分数进行排序。排名按以下规则计算:
    分数应按从高到低排列。
    如果两个分数相等，那么两个分数的排名应该相同。
    在排名相同的分数后，排名数应该是下一个连续的整数。换句话说，排名之间不应该有空缺的数字。
    按 score 降序返回结果表。
    +-------------+---------+
    | Column Name | Type    |
    +-------------+---------+
    | id          | int     |
    | score       | decimal |
    +-------------+---------+
   Id是该表的主键。
该表的每一行都包含了一场比赛的分数。Score是一个有两位小数点的浮点值。
###  【知识点】
1. rank() over
作用：查出指定条件后的进行排名，条件相同排名相同，排名间断不连续。
说明：例如学生排名，使用这个函数，成绩相同的两名是并列，下一位同学空出所占的名次。即：1 1 3 4 5 5 7
2. dense_rank() over
作用：查出指定条件后的进行排名，条件相同排名相同，排名间断不连续。
说明：和rank() over 的作用相同，区别在于dense_rank() over 排名是密集连续的。例如学生排名，使用这个函数，成绩相同的两名是并列，下一位同学接着下一个名次。即：1 1 2 3 4 5 5 6
3. row_number() over
作用：查出指定条件后的进行排名，条件相同排名也不相同，排名间断不连续。
说明：这个函数不需要考虑是否并列，即使根据条件查询出来的数值相同也会进行连续排序。即：1 2 3 4 5 6
dense_rank() over 后面跟排序的依据的列，下面是用了一个排序好的列(order by score desc)。
注意：如果select中有一列是用rank()这类函数，其他的列都会按着他这列规定好的顺序排。
### 【题解】
```mysql
   select score ,
     dense_rank() over (order by score desc) as 'rank'
     from scores
   
```


